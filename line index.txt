<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ—…éŠè¡Œç¨‹ç¢ºèªèˆ‡ç°½ç½²</title>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.0.0/dist/signature_pad.umd.min.js"></script>
    <style>
        body { font-family: -apple-system, sans-serif; background: #f7f9fc; margin: 0; padding: 15px; }
        .container { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); max-width: 500px; margin: auto; }
        h2 { color: #2c3e50; text-align: center; font-size: 20px; border-bottom: 2px solid #00b900; padding-bottom: 10px; }
        .content-box { background: #fffdf0; border: 1px solid #f1c40f; padding: 15px; border-radius: 10px; font-size: 14px; line-height: 1.6; color: #444; margin-bottom: 20px; }
        .menu-item { background: #f0f7ff; border-left: 4px solid #3498db; padding: 8px 12px; margin-bottom: 8px; border-radius: 4px; }
        canvas { border: 2px dashed #bdc3c7; border-radius: 10px; width: 100%; height: 200px; background: #fafafa; touch-action: none; }
        .btn-primary { background: #00b900; color: white; border: none; padding: 14px; width: 100%; border-radius: 10px; font-size: 16px; font-weight: bold; cursor: pointer; margin-top: 10px; }
        .hidden { display: none; }
    </style>
</head>
<body>

<div class="container">
    <div id="step1">
        <h2>å°å—è¡Œç¨‹ç¢ºèª</h2>
        <div class="content-box">
            <strong>ç¬¬ä¸€å¤©ï¼š</strong><br>
            å°å—é«˜éµç«™æœƒåˆ(H31) â†’ å¾®è¶£we chill â†’ å°å—å¸‚å€éŠ â†’ å›æ°‘å®¿ä¼‘æ¯<br><br>
            <strong>ç¬¬äºŒå¤© (éœ€æ—©èµ·)ï¼š</strong><br>
            å¥‡ç¾åšç‰©é¤¨(9:30é€²å ´) â†’ å€‹äººä¼‘é–’æ™‚é–“ â†’ é›†åˆå›é«˜éµç«™ â†’ å›å®¶<br><br>
            <strong>æ—©é¤ Menu å‚™è¨»ï¼š</strong>
            <div class="menu-item">1. éœèª¼ï¼šçƒ¤é†¬é›å ¡ã€çƒé¾(ä¸­)</div>
            <div class="menu-item">2. ç¾¿å©·ï¼šçƒ¤é†¬é›å ¡ã€æ³¢æµªè–¯ã€çƒé¾(å¤§)</div>
            <div class="menu-item">3. å¤§ç¾å¥³ï¼šçƒ¤é†¬é›å ¡ã€çƒé¾(ä¸­)</div>
        </div>
        <button id="go-sign" class="btn-primary" style="background: #3498db;">è¡Œç¨‹ç¢ºèªç„¡èª¤ï¼Œå‰å¾€ç°½å</button>
    </div>

    <div id="step2" class="hidden">
        <h3>âœï¸ æ‰‹å¯«ç°½åç¢ºèª</h3>
        <canvas id="signature-pad"></canvas>
        <button id="submit-btn" class="btn-primary">å®Œæˆç°½ç½²ä¸¦å‚³é€åœ–ç‰‡</button>
        <button id="clear-btn" style="background:none; color:#888; border:none; width:100%; margin-top:10px;">æ¸…é™¤é‡ç°½</button>
    </div>
</div>

<script>
    const LIFF_ID = "2009019667-WKOwwWVI";
    const CLOUD_NAME = "dnvmz8ijx"; 
    const UPLOAD_PRESET = "line_sign";    

    let signaturePad;

    async function init() {
        await liff.init({ liffId: LIFF_ID });
        if (!liff.isLoggedIn()) liff.login();
    }
    init();

    document.getElementById('go-sign').onclick = () => {
        document.getElementById('step1').classList.add('hidden');
        document.getElementById('step2').classList.remove('hidden');
        const canvas = document.getElementById('signature-pad');
        signaturePad = new SignaturePad(canvas, { backgroundColor: 'rgb(255, 255, 255)' });
        const ratio = Math.max(window.devicePixelRatio || 1, 1);
        canvas.width = canvas.offsetWidth * ratio;
        canvas.height = canvas.offsetHeight * ratio;
        canvas.getContext("2d").scale(ratio, ratio);
    };

    document.getElementById('clear-btn').onclick = () => signaturePad.clear();

    document.getElementById('submit-btn').onclick = async () => {
        if (signaturePad.isEmpty()) return alert("è«‹ç°½åï¼");
        const btn = document.getElementById('submit-btn');
        btn.innerText = "åœ–ç‰‡å‚³é€ä¸­...";
        btn.disabled = true;

        const base64Data = signaturePad.toDataURL('image/png');
        const formData = new FormData();
        formData.append('file', base64Data);
        formData.append('upload_preset', UPLOAD_PRESET);

        try {
            const res = await fetch(`https://api.cloudinary.com/v1_1/${CLOUD_NAME}/image/upload`, {
                method: 'POST',
                body: formData
            });
            const data = await res.json();
            const imgUrl = data.secure_url;

            await liff.sendMessages([
                { type: 'text', text: "ğŸ™‹â€â™€ï¸ æˆ‘å·²ç¢ºèªå°å—è¡Œç¨‹èˆ‡æ—©é¤å…§å®¹ï¼" },
                { type: 'image', originalContentUrl: imgUrl, previewImageUrl: imgUrl }
            ]);
            liff.closeWindow();
        } catch (err) {
            alert("å‚³é€å¤±æ•—ï¼Œè«‹æª¢æŸ¥è¨­å®šï¼");
            btn.innerText = "å®Œæˆç°½ç½²ä¸¦å‚³é€åœ–ç‰‡";
            btn.disabled = false;
        }
    };
</script>
</body>
</html>